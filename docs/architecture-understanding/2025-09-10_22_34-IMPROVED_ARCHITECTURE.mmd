graph TB
    %% IMPROVED Architecture - Template-Arch-Lint Project  
    %% Vision: Post-Refactoring Target Architecture
    %% Date: 2025-09-10_22:34:25+02:00

    %% External Layer - CLI with Cobra
    subgraph "CLI Layer - âœ¨ IMPROVED"
        COBRA[ğŸ Cobra CLI Framework<br/>Subcommands: validate, analyze, report<br/>Structured args & flags]
        GRACEFUL[ğŸ›‘ Graceful Shutdown<br/>Signal handling]
        CONFIG_LOADER[âš™ï¸ Config Loader<br/>File + ENV + Flags]
    end

    %% Application Layer - Clean Architecture
    subgraph "Application Layer - âœ¨ ENHANCED"
        subgraph "HTTP Layer"
            GINROUTER[ğŸŒ Gin Router<br/>RESTful endpoints]
            HANDLERS[ğŸ¯ HTTP Handlers<br/>Thin, focused handlers]
            MIDDLEWARE[ğŸ”’ Middleware Stack<br/>Auth, CORS, Rate Limiting]
        end
        
        subgraph "Use Cases"
            USER_USECASE[ğŸ‘¤ User Use Cases<br/>Orchestrates domain services]
            VALIDATION_USECASE[âœ… Validation Use Cases<br/>Coordinates validators]
        end
    end

    %% Domain Layer - CQRS + DDD
    subgraph "Domain Layer - ğŸ—ï¸ FULLY REFACTORED"
        %% Command/Query Separation
        subgraph "CQRS Services"
            QUERYSERVICE[ğŸ” UserQueryService<br/>Read operations only<br/>8 methods + caching]
            COMMANDSERVICE[âœï¸ UserCommandService<br/>Write operations only<br/>Create, Update, Delete]
            VALIDATIONSERVICE[âœ… UserValidationService<br/>Business rule validation<br/>Domain constraints]
            FILTERSERVICE[ğŸ”½ UserFilterService<br/>Complex filtering logic<br/>Query optimization]
        end
        
        %% Rich Domain Entities
        subgraph "Rich Domain Model"
            USER_ENTITY[ğŸ‘¤ User Entity<br/>Rich behavior, no primitives<br/>Domain methods only]
            USER_AGGREGATE[ğŸ‘¥ User Aggregate<br/>Consistency boundary<br/>Business invariants]
        end
        
        %% Complete Value Objects
        subgraph "Value Objects - ğŸ’ COMPLETE"
            USERID[ğŸ†” UserID<br/>Generation + Validation]
            EMAIL[ğŸ“§ Email<br/>Domain + LocalPart methods]  
            USERNAME[ğŸ‘¤ UserName<br/>Reserved names + Rules]
            USERSTATUS[ğŸŸ¢ UserStatus<br/>Active/Inactive/Suspended]
            DOMAIN_NAME[ğŸŒ DomainName<br/>Email domain validation]
        end
        
        %% Domain Events
        subgraph "Domain Events - ğŸª NEW"
            USER_CREATED[ğŸ‰ UserCreatedEvent]
            USER_UPDATED[ğŸ“ UserUpdatedEvent]
            USER_DELETED[ğŸ—‘ï¸ UserDeletedEvent]
            EMAIL_CHANGED[ğŸ“§ EmailChangedEvent]
        end
        
        %% Domain Services
        subgraph "Domain Services"
            EMAIL_SERVICE[ğŸ“§ EmailDomainService<br/>Business logic for emails]
            USERNAME_SERVICE[ğŸ‘¤ UserNameService<br/>Uniqueness + Rules]
            AUDIT_SERVICE[ğŸ“‹ AuditService<br/>Change tracking]
        end
        
        %% Repositories - Clean Interfaces
        subgraph "Repository Abstractions"
            USER_REPOSITORY[ğŸ“š UserRepository<br/>Clean interface]
            EVENT_REPOSITORY[ğŸª EventRepository<br/>Event sourcing ready]
            CACHE_REPOSITORY[âš¡ CacheRepository<br/>Performance layer]
        end
        
        %% Functional Patterns
        subgraph "Functional Patterns - ğŸš‚ RAILWAY"
            RESULT[ğŸš‚ Result[T]<br/>Railway Oriented Programming]
            OPTION[â“ Option[T]<br/>Null safety everywhere]
            EITHER[ğŸ”€ Either[L,R]<br/>Two-path computations]
        end
        
        %% Error Handling
        subgraph "Domain Errors - âš ï¸ COMPREHENSIVE"
            VALIDATION_ERROR[âš ï¸ ValidationError]
            BUSINESS_ERROR[ğŸ’¼ BusinessRuleError]
            NOTFOUND_ERROR[âŒ NotFoundError]
            CONFLICT_ERROR[âš¡ ConflictError]
            AUTHORIZATION_ERROR[ğŸ”’ AuthorizationError]
        end
    end

    %% Infrastructure Layer - Enterprise Ready
    subgraph "Infrastructure Layer - ğŸ¢ ENTERPRISE"
        %% Repository Implementations
        subgraph "Persistence"
            SQLITE_REPO[ğŸ—„ï¸ SQLiteUserRepository<br/>Production implementation]
            INMEM_REPO[ğŸ’¾ InMemoryUserRepository<br/>Testing implementation]
            CACHE_IMPL[âš¡ RedisCache<br/>Distributed caching]
        end
        
        %% External Services
        subgraph "External Integrations"
            EMAIL_PROVIDER[ğŸ“§ Email Service<br/>SendGrid/SES integration]
            AUDIT_LOGGER[ğŸ“‹ Audit Logger<br/>Compliance logging]
            METRICS[ğŸ“Š Metrics Collection<br/>Prometheus/OTEL]
        end
        
        %% Configuration
        subgraph "Configuration Management"
            ENV_CONFIG[ğŸŒ Environment Config<br/>12-factor app ready]
            FILE_CONFIG[ğŸ“„ File Config<br/>YAML/JSON support]
            SECRETS[ğŸ” Secret Management<br/>Vault integration]
        end
    end

    %% Persistence Layer
    subgraph "Data Layer"
        SQLITE[ğŸ—„ï¸ SQLite Database<br/>Primary storage]
        REDIS[ğŸ”´ Redis<br/>Caching + Sessions]
        SQLC[ğŸ”§ SQLC Generated<br/>Type-safe queries]
        MIGRATIONS[ğŸ”„ Database Migrations<br/>Version controlled]
    end

    %% Frontend Layer
    subgraph "Presentation Layer"
        TEMPL[ğŸ¨ Templ Templates<br/>Type-safe, compiled]
        HTMX[âš¡ HTMX<br/>Progressive enhancement]
        CSS[ğŸª TailwindCSS<br/>Design system ready]
        COMPONENTS[ğŸ§© Component Library<br/>Reusable UI elements]
    end

    %% Observability Stack
    subgraph "Observability - ğŸ‘ï¸ MONITORING"
        LOGGING[ğŸ“ Structured Logging<br/>JSON + Context]
        TRACING[ğŸ” Distributed Tracing<br/>OpenTelemetry]
        MONITORING[ğŸ“Š Metrics Dashboard<br/>Business + Technical]
        ALERTING[ğŸš¨ Alert Manager<br/>Proactive notifications]
    end

    %% Dependencies - Clean Flow
    COBRA --> CONFIG_LOADER
    COBRA --> USER_USECASE
    COBRA --> GRACEFUL
    
    GINROUTER --> HANDLERS
    HANDLERS --> MIDDLEWARE
    HANDLERS --> USER_USECASE
    
    USER_USECASE --> QUERYSERVICE
    USER_USECASE --> COMMANDSERVICE
    USER_USECASE --> VALIDATIONSERVICE
    
    COMMANDSERVICE --> USER_AGGREGATE
    COMMANDSERVICE --> USER_CREATED
    COMMANDSERVICE --> USER_UPDATED
    COMMANDSERVICE --> USER_DELETED
    
    QUERYSERVICE --> FILTERSERVICE
    QUERYSERVICE --> CACHE_IMPL
    QUERYSERVICE --> USER_REPOSITORY
    
    USER_AGGREGATE --> USERID
    USER_AGGREGATE --> EMAIL
    USER_AGGREGATE --> USERNAME
    USER_AGGREGATE --> USERSTATUS
    
    VALIDATIONSERVICE --> EMAIL_SERVICE
    VALIDATIONSERVICE --> USERNAME_SERVICE
    VALIDATIONSERVICE --> BUSINESS_ERROR
    
    EMAIL --> DOMAIN_NAME
    EMAIL --> EMAIL_SERVICE
    USERNAME --> USERNAME_SERVICE
    
    USER_REPOSITORY --> SQLITE_REPO
    USER_REPOSITORY --> INMEM_REPO
    EVENT_REPOSITORY --> SQLITE
    
    SQLITE_REPO --> SQLC
    SQLITE_REPO --> MIGRATIONS
    CACHE_IMPL --> REDIS
    
    HANDLERS --> TEMPL
    TEMPL --> COMPONENTS
    TEMPL --> HTMX
    TEMPL --> CSS
    
    %% Observability Integration
    COMMANDSERVICE --> LOGGING
    QUERYSERVICE --> METRICS
    USER_USECASE --> TRACING
    GINROUTER --> MONITORING
    
    LOGGING --> ALERTING
    METRICS --> MONITORING
    TRACING --> MONITORING

    %% Color Classes
    %% New/Improved - Green
    classDef improved fill:#00b894,stroke:#00a085,color:#fff
    class COBRA,QUERYSERVICE,COMMANDSERVICE,VALIDATIONSERVICE,FILTERSERVICE,USER_AGGREGATE,USERSTATUS,DOMAIN_NAME,USER_CREATED,USER_UPDATED,USER_DELETED,EMAIL_CHANGED improved
    
    %% Enterprise - Blue
    classDef enterprise fill:#74b9ff,stroke:#0984e3,color:#fff  
    class CACHE_IMPL,EMAIL_PROVIDER,AUDIT_LOGGER,METRICS,SECRETS,REDIS,TRACING,MONITORING,ALERTING enterprise
    
    %% Domain Core - Purple
    classDef domain fill:#a29bfe,stroke:#6c5ce7,color:#fff
    class USER_ENTITY,EMAIL_SERVICE,USERNAME_SERVICE,AUDIT_SERVICE,RESULT,OPTION,EITHER domain
    
    %% Infrastructure - Gray
    classDef infra fill:#636e72,stroke:#2d3436,color:#fff
    class SQLITE_REPO,INMEM_REPO,SQLITE,SQLC,MIGRATIONS,LOGGING infra