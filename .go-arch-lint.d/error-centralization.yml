# ğŸ” ERROR CENTRALIZATION VALIDATION
# Enforce ALL error definitions in pkg/errors/ for both libs and applications
#
# This file validates that NO direct error creation happens outside pkg/errors/
# Only error checking (Is, As, Unwrap) is allowed elsewhere

version: 3
workdir: .

name: error-centralization-validation
description: "Enforce centralized error management in pkg/errors/"

# ğŸš« FORBIDDEN PATTERNS - Direct error creation outside pkg/errors
forbidden:
  # Pattern: Direct errors.New() usage (only allowed in pkg/errors)
  - pattern: 'errors\.New\('
    message: "ğŸš¨ BANNED: Direct error creation. Use pkg/errors predefined types instead."
    allowed_paths:
      - "pkg/errors/**"
    
  # Pattern: Direct fmt.Errorf() usage (only allowed in pkg/errors)
  - pattern: 'fmt\.Errorf\('
    message: "ğŸš¨ BANNED: Direct error formatting. Use pkg/errors predefined types instead."
    allowed_paths:
      - "pkg/errors/**"

  # Pattern: Anonymous error struct creation
  - pattern: 'error\(\s*{'
    message: "ğŸš¨ BANNED: Anonymous error structs. Use pkg/errors Error type instead."
    allowed_paths:
      - "pkg/errors/**"

# âœ… ALLOWED PATTERNS - Error checking is fine everywhere
allowed:
  # Error checking functions (allowed everywhere)
  - pattern: 'errors\.Is\('
    description: "Error type checking - allowed everywhere"
  - pattern: 'errors\.As\('
    description: "Error type assertion - allowed everywhere"
  - pattern: 'errors\.Unwrap\('
    description: "Error unwrapping - allowed everywhere"
  - pattern: 'errors\.Join\('
    description: "Error joining - allowed everywhere"

# ğŸ“‹ IMPORT RESTRICTIONS
import_restrictions:
  # Ban error creation packages outside pkg/errors
  forbidden_imports:
    - "errors"  # Only allowed in pkg/errors
    - "fmt"     # Only for fmt.Errorf in pkg/errors
  allowed_files_for_banned_imports:
    - "pkg/errors/**/*.go"

# ğŸ¯ VALIDATION RULES
validation_rules:
  - name: "pkg-errors-mandatory"
    description: "All components must depend on pkg/errors"
    rule: "every_component_except_pkg_errors_must_depend_on_pkg_errors"
    message: "All components MUST use centralized error management in pkg/errors"

# ğŸ—ï¸ ENFORCEMENT CONFIGURATION
enforcement:
  mode: "strict"
  fail_on_violation: true
  auto_fix: false  # Requires manual review for proper error design
  include_tests: true  # Apply to test files too

# ğŸ“ EXAMPLES OF PROPER USAGE:
#
# âœ… CORRECT (using centralized errors):
//   import "yourproject/pkg/errors"
//   return errors.NewUserNotFoundError(id)
//   if errors.IsUserNotFound(err) { /* handle */ }
#
# âŒ WRONG (direct error creation):
//   import "errors"
//   return errors.New("user not found")
#
# âœ… CORRECT (error checking):
//   if errors.Is(err, someError) { /* handle */ }
//   var userErr *errors.Error
//   if errors.As(err, &userErr) { /* handle */ }
#