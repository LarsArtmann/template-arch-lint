# Library Error Centralization Rules
# STRICT enforcement for library projects - ALL errors in one place

version: 3
workdir: .

rules:
  # Rule: ABSOLUTE error centralization for libraries
  - name: lib-error-centralization
    description: "Library: ALL error definitions must be in pkg/errors/ - no exceptions"
    allowed:
      - pkg/errors/**
    forbidden:
      - "**/*.go": {contains: "errors.New", "fmt.Errorf", "error("}
    exceptions:
      - "No exceptions - libraries must use centralized error types"
    action:
      type: "move-or-refactor"
      message: "Library projects MUST centralize ALL errors in pkg/errors/ - no direct error creation"
    
  # Rule: Complete import ban on error creation packages
  - name: lib-error-import-ban
    description: "Library: Ban error creation packages outside pkg/errors"
    forbidden_imports:
      - "errors"  # Ban completely except in pkg/errors
      - "fmt"     # Ban fmt.Errorf completely
    allowed_files:
      - "pkg/errors/**/*.go"  # Only place allowed to import these
    action:
      type: "refactor-import"
      message: "Import errors/fmt only in pkg/errors/ - use predefined error types everywhere else"
    
  # Rule: Only error checking allowed outside pkg/errors
  - name: lib-error-checking-only
    description: "Library: Only error checking (Is, As, Unwrap) allowed outside pkg/errors"
    allowed_patterns:
      - "errors.Is"
      - "errors.As" 
      - "errors.Unwrap"
      - "errors.Join"
    forbidden_patterns:
      - "errors.New"
      - "fmt.Errorf"
      - "error("  # Anonymous error struct creation
    allowed_files:
      - "**/*.go"  # Apply to all files
    action:
      type: "refactor-error"
      message: "Use pkg/errors predefined types instead of creating errors directly"

# Configuration for go-arch-lint enforcement
enforcement:
  mode: "strict"
  fail_on_violation: true
  auto_fix: false  # Manual review required for error design